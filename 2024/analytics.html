<!DOCTYPE html>
<html lang="en">
<head>
   
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>starly dot dev - My Adventure in Building Umami</title>
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="starly.dev" />
        
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://starly.dev/2024/analytics.html" />
        <meta property="og:title" content="My Adventure in Building Umami" />
        <meta name="twitter:title" content="My Adventure in Building Umami" />
        <meta property="og:description" content="<p>How I set up website analytics tracking with Umami</p>" />
        <meta name="twitter:description" content="<p>How I set up website analytics tracking with Umami</p>" />
        <meta property="og:image" content="https://starly.dev/extra/og-default.png" />
        <meta name="twitter:image" content="https://starly.dev/extra/og-default.png" />
   
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"/>
        <link rel="stylesheet" type="text/css" href="https://starly.dev/theme/css/main.css"/>

<meta name="tags" content="misc" />
</head>
<body>
<style>.github-corner:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out
}
@keyframes octocat-wave {
    0%, 100% {
        transform: rotate(0)
    }
    20%, 60% {
        transform: rotate(-25deg)
    }
    40%, 80% {
        transform: rotate(10deg)
    }
}
@media (max-width: 500px) {
    .github-corner:hover .octo-arm {
        animation: none
    }

    .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
}</style><div id="container">
    <header>
        <h1><a href="https://starly.dev/">starly dot dev</a></h1>
            <ul class="social-media">
                    <li><a href="https://github.com/mr4tt" target="_blank" data-umami-event="fa-brands fa-github"><i class="fa-brands fa-github" aria-hidden="true"></i></a></li>
                    <li><a href="mailto:hello.mrat@gmail.com" target="_blank" data-umami-event="fa-regular fa-envelope"><i class="fa-regular fa-envelope" aria-hidden="true"></i></a></li>
            </ul>
        <p><em></em></p>
    </header>
    <nav>
        <ul>
                    <li><a href="https://starly.dev/category/comics.html" data-umami-event="Comics">Comics</a></li>
                    <li><a  class="active" href="https://starly.dev/category/misc.html" data-umami-event="Misc">Misc</a></li>
                    <li><a href="https://starly.dev/category/portfolio.html" data-umami-event="Portfolio">Portfolio</a></li>
                    <li><a href="https://starly.dev/pages/about-me.html" data-umami-event="About Me">About Me</a></li>
        </ul>
    </nav>
<main>
    <article>
        <h1>My Adventure in Building Umami</h1>
        
        <aside>
            <ul>
                <li>
                    <time datetime="2024-04-05 19:37:00-07:00">Apr 05, 2024</time>
                </li>
                <!--  -->
                <li>
                    Categories:
                    <a href="https://starly.dev/category/misc.html"><em>Misc</em></a>
                </li>
                <li>
                    Tags:
                    <a href="https://starly.dev/tag/misc.html"><em>#misc</em></a>
                </li>
            </ul>
        </aside>
        <script src="https://starly.dev/2024/medium-zoom.js"></script>

<script src="https://starly.dev/2024/nutshelldev.js"></script>
<script>
Nutshell.setOptions({
    dontEmbedHeadings: true, // If 'true', removes the "embed this as a nutshell" option on headings
});
</script>

<p>I'll be testing <a href="https://github.com/ncase/nutshell">Nutshell</a> out! When you see a link like <a href="#note1">:this</a>, click on it to expand it.</p>
<hr>
<p><img alt="umami screens overlaid" class="zoomable" src="https://starly.dev/2024/cover.jpg"></p>
<p><a href="https://umami.is/">Umami</a>. is an open source analytics provider focused on privacy. This means you can see information about people who visit your website, like their country. </p>
<p>You can find Starly's analytics dashboard <a href="https://umami.starly.dev/share/hNfhWdonj5bA5dBj/starly.dev">here</a> !</p>
<hr>
<p>Google Analytics has more metrics, but I didn't need a lot of their advanced features (who would have thought my tiny blog wouldn't need ad revenue tracking). And lack of privacy and GDPR non-compliant or something. </p>
<p>There's other Google Analytics alternatives, but they cost money, so I didn't read much of their websites. </p>
<p>If you're just here to figure out installing Umami without any extra bits, you'll be fine following only the bullet points. </p>
<hr>
<h2>Software Requirements</h2>
<ul>
<li>i am using Ubuntu 23.10 on a Digital Ocean instance</li>
<li>install Node.js, <a class="blue-link" href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-22-04" target="_blank">tutorial</a></li>
<li>install Nginx, <a class="blue-link" href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-22-04" target="_blank">tutorial</a></li>
<li>install PostgreSQL, <a class="blue-link" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-22-04" target="_blank">tutorial</a><ul>
<li>you can also use MySQL with Umami, but this post uses postgres</li>
</ul>
</li>
</ul>
<p>actual install docs from umami are <a href="https://umami.is/docs/install" target="_blank">here</a></p>
<h2>Install and run Umami</h2>
<ol>
<li>
<p><strong>set up yarn</strong></p>
<ul>
<li>run <code>corepack enable</code></li>
</ul>
<p>We use Yarn (package manager, similar to npm) to install necessary packages. This is activated with corepack, which comes with our Node.js installation. </p>
<p>You can use npm instead, but I haven't tried it. </p>
<p>For more info, yarn installation docs are <a href="https://yarnpkg.com/getting-started/install" target="_blank">here</a></p>
</li>
<li>
<p><strong>set up umami</strong></p>
<ul>
<li><code>git clone https://github.com/umami-software/umami.git</code></li>
<li><code>cd umami</code></li>
<li><code>yarn</code></li>
</ul>
<p>To set up Umami, clone the repo and run <code>yarn</code> inside, which looks at the <code>package.json</code> file in the repo and downloads the packages specified there. </p>
</li>
<li>
<p><strong>set up postgres and connection string</strong></p>
<ul>
<li>run <code>createdb --username=postgres --host=localhost umami</code></li>
<li>create a <code>.env</code> file in the cloned umami folder</li>
<li>put this line in <code>.env</code>, filling in your Postgres's details: <code>DATABASE_URL=postgresql://[USERNAME]:[PASSWORD]@[DB_LOCATION]:[PORT]/[DATABASE_NAME]</code></li>
</ul>
<p>Use the <code>createdb</code> command to create a database called umami. Then, put your connection string into a new <code>.env</code> file so Umami knows how to connect to your Postgres instance and which database to put the metrics in. </p>
<p>my <a href="#postgresNote1">:example string</a>.</p>
<p>Note: If you've installed postgres for the first time, you may want to make another user besides the default (postgres), set a password, or change authentication methods.</p>
</li>
<li>
<p><strong>build Umami</strong></p>
<ul>
<li><code>yarn build</code></li>
<li>some optional things:<ul>
<li><code>yarn next telemetry disable</code> to disable Next.js telemetry</li>
<li>to change the port next.js uses (default is 3000), go to <code>package.json</code>, change <code>next start</code> to be <code>next start -p [new port]</code></li>
</ul>
</li>
</ul>
<p>Running <code>yarn build</code> looks at the <code>scripts</code> section of <code>package.json</code> and executes the commands found under <code>build</code>.</p>
<p>Note: Building eats a lot of memory and the base Digital Ocean server may not have enough memory to run it without upgrading or configuring more swap (I learned the hard way!). </p>
<p><a href="#swap">:More about swap</a></p>
</li>
<li>
<p><strong>start Umami</strong></p>
<ul>
<li>run <code>npm start</code></li>
<li>go to <code>http://[IP]:3000/</code>, where <code>[IP]</code> is the IP address of your server</li>
<li>log in<ul>
<li>username: admin</li>
<li>password: umami</li>
<li>log in <a href="#login">:screenshot</a></li>
</ul>
</li>
<li>go to Settings -&gt; Users to change your password</li>
</ul>
<p>Optional: use <a href="https://pm2.keymetrics.io/docs/usage/quick-start/" target="_blank">PM2</a>, a process manager, to manage your Umami instance. This makes it easier to start and stop Umami when it stops running, like when you restart your server. </p>
<ul>
<li><code>npm install pm2 -g</code></li>
<li><code>pm2 start npm --name umami -- start</code><ul>
<li>make sure you're in the umami folder before running</li>
</ul>
</li>
<li><code>pm2 save</code></li>
</ul>
<p>These steps install PM2 globally, start the Umami instance, and saves it in a list that you can easily restart later.</p>
</li>
<li>
<p><strong>set up site</strong></p>
<ul>
<li>in Umami, go to Settings &gt; Websites</li>
<li>click Add Website<ul>
<li>name: can be anything you want (e.g. starly)</li>
<li>domain: your website domain (e.g. starly.dev)</li>
<li>add website <a href="#add_site">:screenshot</a></li>
</ul>
</li>
<li>click edit &gt; tracking code <ul>
<li>copy tracking code and put it somewhere in the <code>&lt;head&gt;...&lt;/head&gt;</code> tag of your website</li>
<li>tracking code <a href="#screenshot">:screenshot</a></li>
</ul>
</li>
<li>optional:<ul>
<li>edit &gt; enable share URL if you'd like to share the dashboard</li>
</ul>
</li>
<li>test by going to your website and seeing if the visitor count goes up</li>
</ul>
<p>If you don't want to track your own visits to your website, you can add <code>umami.disabled</code> with a value of <code>1</code>.</p>
<p><a href="#disable">:How?</a></p>
</li>
</ol>
<hr>
<p>There's other things to play around with like reports and insights, but I haven't gotten around to it yet. </p>
<p>At this point, you're done setting Umami up and have reliable metrics about your website! </p>
<h2>There's <em>more</em>??</h2>
<p>One other thing I did was set up umami.starly.dev as the domain to send (proxy) Umami requests to. This means that you can access Umami at your chosen domain instead of <code>http://[IP]:3000/</code>.</p>
<p>If your website is hosted on the same server that you're running Umami on, you only need to add an Nginx configuration to change the domain. However, because I'm running most of the website on Github Pages, I also had to change my DNS settings to tell the internet where umami.starly.dev is. </p>
<p>If you want to use https, you will have to set up SSL certs on your server. </p>
<h2>Proxy Umami Requests</h2>
<ol>
<li>
<p><strong>set up DNS so requests go to your server</strong> <br> (only needed if Umami and your website are hosted in different places!!!!!)</p>
<ul>
<li>add a new A record to your DNS <ul>
<li>name: the subdomain you want to use<ul>
<li>e.g. use umami if you want to point to umami.starly.dev</li>
</ul>
</li>
<li>address: your server's IP address</li>
</ul>
</li>
<li><a href="#dns">:What should my DNS look like?</a></li>
</ul>
</li>
<li>
<p><strong>set up nginx config so requests go to Umami</strong></p>
<ul>
<li>run <code>systemctl status nginx</code> to check if nginx is running<ul>
<li>if not, try <code>sudo systemctl start nginx</code></li>
</ul>
</li>
<li>go to <code>/etc/nginx/nginx.conf</code> and remove any <code>location /</code> blocks currently inside</li>
<li>
<p>paste the following inside the <code>http { }</code> block</p>
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:80</span><span class="p">;</span>

<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">umami.yourdomain.com</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:3000</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</li>
<li>
<p>example of <a href="#nginx">:<code>nginx.conf</code></a></p>
</li>
<li>run <code>sudo nginx -s reload</code> to reload config changes</li>
<li>go to <code>umami.yourdomain.com</code> and check if it pulls up the Umami website</li>
</ul>
<p>The config tells nginx to listen on port 80 (which is where internet traffic goes through). Now, when someone goes to <code>http://umami.yourdomain.com</code>, nginx hears it and knows to return whatever is at <code>localhost:3000</code> to that person.</p>
<p>If you can't access it, here are some <a href="#troubleshoot">:troubleshooting steps</a></p>
</li>
<li>
<p><strong>set up SSL certs</strong> <br> (only needed if you want https support!!!!!!)</p>
<p><a href="#https">:What's http/https? Why would I need an SSL cert?</a></p>
<p>There are two different ways to get an SSL certificate: </p>
<ul>
<li>Let's Encrypt</li>
<li>Cloudflare<ul>
<li>If you're already using Cloudflare to manage DNS, it's easier to use Cloudflare</li>
</ul>
</li>
</ul>
<p>I have not used Let's Encrypt, so this guide only covers Cloudflare. Here are Let's Encrypt's directions:</p>
<ul>
<li><a class="blue-link" href="https://letsencrypt.org/getting-started/" target="_blank">Getting Started</a></li>
<li><a class="blue-link" href="https://certbot.eff.org/instructions?ws=nginx&amp;os=ubuntufocal" target="_blank">Instructions</a> for nginx and Ubuntu</li>
</ul>
<p>Steps for using Cloudflare certs:</p>
<ol>
<li>
<p><strong>generate TLS cert</strong></p>
<ul>
<li>login to Cloudflare, go to the TLS/SSL section (found on the left), then Origin Server</li>
<li>click Create Certificate and don't change the options </li>
<li>click Create to see your new certificate's information<ul>
<li>Note: <strong>do not</strong> leave the information page without copying your private key</li>
</ul>
</li>
<li>copy the Origin Certificate into <code>/etc/ssl/cert.pem</code> on your server</li>
<li>copy your private key into <code>/etc/ssl/key.pem</code> on your server <ul>
<li>Note: make sure your certs don't have spaces or newlines</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>update nginx config</strong></p>
<ul>
<li>
<p>paste the following under your previous server block listening on port 80</p>
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="s">ssl</span><span class="w"> </span><span class="s">http2</span><span class="p">;</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:443</span><span class="w"> </span><span class="s">ssl</span><span class="w"> </span><span class="s">http2</span><span class="p">;</span>
<span class="w">    </span><span class="kn">ssl_certificate</span><span class="w">         </span><span class="s">/etc/ssl/cert.pem</span><span class="p">;</span>
<span class="w">    </span><span class="kn">ssl_certificate_key</span><span class="w">     </span><span class="s">/etc/ssl/key.pem</span><span class="p">;</span>

<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">umami.starly.dev</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:3000/</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

</li>
<li>
<p>Now, you should be able to access Umami from <code>https://umami.starly.dev</code>. </p>
</li>
</ul>
</li>
</ol>
<p>You can also change your tracking code to use <code>umami.yourdomain.com</code> (you can copy the code again from Umami)</p>
</li>
</ol>
<h2>Updating</h2>
<p>It's simple to update your Umami instance when a new version comes out! </p>
<ul>
<li><code>cd umami</code></li>
<li><code>git pull</code></li>
<li><code>yarn</code></li>
<li><code>yarn build</code></li>
<li><code>npm start</code> or <code>pm2 reload umami</code> for PM2</li>
</ul>
<p>These steps fetch the update from Github, install any new dependencies from the update, rebuild Umami, and restart it. </p>
<h2>How does Umami work?</h2>
<p>How does Umami get data from visitors and put it into your dashboard? </p>
<p>When you put your Umami tracking code into the <code>&lt;head&gt;</code> tag of your website, the <a href="https://github.com/umami-software/umami/blob/88da20ea7f9e34a3d09cf8503ae09bff63b254bc/src/tracker/index.js" target="_blank"><code>script.js</code></a> file on your server gets called. The script gets information from http headers like which website page you're looking at and listens for any events that you've set up with Umami (such as button clicks). </p>
<p>Next, this information is sent to your database, and when you look at the dashboard, it pulls that information for you. </p>
<p>If you're using nginx, you may have noticed the following lines:</p>
<div class="highlight"><pre><span></span><code><span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="k">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</code></pre></div>

<p>These headers are forwarded from the original request to Umami, so even if you're proxying the connection, Umami can still get the data it needs for analytics. </p>
<h2>Summary</h2>
<p>Overall, Umami is a great tool to get analytics about your website. Just install Umami from the Github repository onto your server and put your tracking code onto your website. If desired, you can set up a subdomain for Umami using Nginx. </p>
<h2>:x note1</h2>
<p>hi!</p>
<h2>:x postgresNote1</h2>
<p><code>DATABASE_URL=postgresql://username:password@localhost:5432/umami</code></p>
<ul>
<li>Postgres's default port is 5432, so use this if you have not configured another port </li>
<li>Use localhost if your Postgres is on the same server as Umami; otherwise, use the IP of the server Postgres is located on</li>
</ul>
<h2>:x swap</h2>
<p>Swap is hard drive space used as RAM. Although it is much slower than actual RAM, it can be used when you run out of actual RAM. However, it will slow your system down a lot. </p>
<p>The following commands let you configure swap on your server, where count is the amount of memory you'd like to use for swapping. </p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/bin/dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/var/swap.1<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">1024</span>
sudo<span class="w"> </span>/sbin/mkswap<span class="w"> </span>/var/swap.1
sudo<span class="w"> </span>/sbin/swapon<span class="w"> </span>/var/swap.1
</code></pre></div>

<ul>
<li>First command makes a file in <code>/var</code> named <code>swap.1</code> with 1024mb filled with 0s (basically just allocating space for the file).</li>
<li>Second command formats the swap.1 file as a swap area. </li>
<li>Third command tells the OS you'd like to start using the swap space</li>
</ul>
<p>This change will not be permanent unless you add this info to your <code>/etc/fstab</code> file, which is where your OS references information about how to open file systems like USBs or where swap is. </p>
<p>Another parameter that can be configured is swappiness, which controls how often swap is used. It goes from 0-100: 0 means swap will not be used until the system runs out of RAM, and 100 means swap will start being used almost immediately. The default is 60, meaning swap will be used at around 60% of RAM usage. </p>
<p>This value can be checked with <code>cat /proc/sys/vm/swappiness</code></p>
<p>More info <a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-22-04">here</a></p>
<p>Windows has a similar concept called page / pagefile; <a href="https://stackoverflow.com/a/1689119">here</a> is a good summary of both.</p>
<h2>:x login</h2>
<p><img alt="screenshot of umami's login page" src="https://starly.dev/2024/login.png"></p>
<h2>:X add_site</h2>
<p><img alt="screenshot of adding a website in umami" src="https://starly.dev/2024/add_site.png"></p>
<h2>:x screenshot</h2>
<p><img alt="screenshot of where to find tracking code" src="https://starly.dev/2024/script.png"></p>
<h2>:x disable</h2>
<ol>
<li>go to your website and inspect element</li>
<li>go to the Application tab </li>
<li>go to Cookies</li>
<li>double click the next available space below <code>Name</code> and type <code>umami.disabled</code></li>
<li>add a value to it of <code>1</code></li>
</ol>
<p><img alt="cookie example" src="https://starly.dev/2024/cookie.png"></p>
<h2>:x dns</h2>
<p><img alt="screenshot of DNS settings" src="https://starly.dev/2024/dns.png"></p>
<p>Note: I have the Github A records because I use Github Pages to host my website</p>
<h2>:x nginx</h2>
<div class="highlight"><pre><span></span><code><span class="k">user</span><span class="w"> </span><span class="s">www-data</span><span class="p">;</span>
<span class="k">worker_processes</span><span class="w"> </span><span class="s">auto</span><span class="p">;</span>
<span class="k">pid</span><span class="w"> </span><span class="s">/run/nginx.pid</span><span class="p">;</span>
<span class="k">error_log</span><span class="w"> </span><span class="s">/var/log/nginx/error.log</span><span class="p">;</span>

<span class="k">events</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">768</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">http</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">sendfile</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">        </span><span class="kn">tcp_nopush</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">        </span><span class="kn">types_hash_max_size</span><span class="w"> </span><span class="mi">2048</span><span class="p">;</span>
<span class="w">        </span><span class="kn">include</span><span class="w"> </span><span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
<span class="w">        </span><span class="kn">default_type</span><span class="w"> </span><span class="s">application/octet-stream</span><span class="p">;</span>
<span class="w">        </span><span class="kn">ssl_prefer_server_ciphers</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>

<span class="w">        </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/access.log</span><span class="p">;</span>
<span class="w">        </span><span class="kn">gzip</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>

<span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">            </span><span class="kn">listen</span><span class="w"> </span><span class="s">[::]:80</span><span class="p">;</span>

<span class="w">            </span><span class="kn">server_name</span><span class="w"> </span><span class="s">umami.starly.dev</span><span class="p">;</span>

<span class="w">            </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://localhost:3500/</span><span class="p">;</span>
<span class="w">                </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">                </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">                </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2>:x troubleshoot</h2>
<ul>
<li>run <code>sudo nginx -t</code> to check for syntax errors (should say OK)</li>
<li>check <code>/var/log/nginx/error.log</code> to look at logged errors</li>
<li>run <code>systemctl status nginx</code> to ensure nginx is running</li>
<li>run <code>sudo ufw status</code> to check if your firewall is allowing connections in/out</li>
</ul>
<h2>:x https</h2>
<p>http is a way for computers to fetch the website data you've requested. https is the same protocol, but there's an extra layer of security on top. </p>
<p>When you go to a website with https, your browser checks the website's SSL certificate. Your browser does a TLS handshake, which is an exchange of encryption keys between you and the website's server made possible by the SSL certificate's information. </p>
<p>Now, your browser can encrypt your data using these keys so that only you and the website can read your data. The certificate also ensures the website you're going to is who they claim to be.</p>
<script>  
const zoom = mediumZoom('.zoomable')
</script>
    </article>
    <section class="post-nav">
        <div id="left-page">
            <div id="left-link">
            </div>
        </div>
        <div id="right-page">
            <div id="right-link">
            </div>
        </div>
    </section>
    <div>
    </div>
</main>
    <footer>
        <h6>
            Rendered by <a href="http://getpelican.com/">Pelican</a> &nbsp;&bull;&nbsp; Theme by <a href="https://github.com/aleylara/Peli-Kiera">Peli-Kiera</a> 
            &nbsp;&bull;&nbsp;   By mrat         </h6>
    </footer>
</div>
</body>
</html>
